# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞

## –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø–æ—Å–ª–µ git push)

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /ssd/www/youpub

# 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
git pull origin main

# 3. –ï—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î, –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:
ls -la database/migrations/

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é:
mysql -u youpub_user -p youpub_db < database/migrations/006_fix_youtube_account_fields.sql

# –ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç):
# bash database/apply_migration.sh

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sudo chown -R www-data:www-data /ssd/www/youpub
sudo chmod -R 755 /ssd/www/youpub
sudo chmod -R 775 /ssd/www/youpub/storage

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PHP-FPM (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sudo systemctl restart php8.1-fpm
# –∏–ª–∏
sudo service php8.1-fpm restart

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
tail -f /var/log/apache2/error.log
# –∏–ª–∏
tail -f /ssd/www/youpub/storage/logs/error.log
```

## –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /ssd/www/youpub

# 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏)
git stash

# 3. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
git status

# 5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ)
# –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π:
ls -lt database/migrations/ | head -10

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é:
mysql -u youpub_user -p youpub_db < database/migrations/006_fix_youtube_account_fields.sql

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
php -l index.php
php -l app/Controllers/DashboardController.php

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
ls -la storage/
ls -la storage/uploads/

# 8. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl restart apache2
sudo systemctl restart php8.1-fpm

# 9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞
curl -I https://you.1tlt.ru
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ YouTube –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```bash
cd /ssd/www/youpub
git pull origin main

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–µ–π account_name –∏ is_default
mysql -u youpub_user -p youpub_db < database/migrations/006_fix_youtube_account_fields.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
mysql -u youpub_user -p youpub_db -e "DESCRIBE youtube_integrations;"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PHP-FPM
sudo systemctl restart php8.1-fpm
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π)

```bash
cd /ssd/www/youpub
git pull origin main
sudo systemctl restart php8.1-fpm
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
cd /ssd/www/youpub
git pull origin main

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å config/env.php (–Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ git, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
cat config/env.php | grep YOUTUBE

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl restart apache2
sudo systemctl restart php8.1-fpm
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
tail -n 50 /var/log/apache2/error.log | grep -i error
tail -n 50 /ssd/www/youpub/storage/logs/error.log

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞
curl https://you.1tlt.ru/login

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
mysql -u youpub_user -p youpub_db -e "SELECT COUNT(*) FROM users;"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
mysql -u youpub_user -p youpub_db -e "SHOW TABLES;"
mysql -u youpub_user -p youpub_db -e "DESCRIBE youtube_integrations;"
```

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
cd /ssd/www/youpub

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
git log --oneline -10

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
git reset --hard HEAD~1

# –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç
git reset --hard <commit_hash>

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
git pull origin main --force
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/ssd/www/youpub/update.sh`:

```bash
#!/bin/bash
set -e

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞ YouPub..."

cd /ssd/www/youpub

echo "üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ Git..."
git pull origin main

echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
# echo "üóÑÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π..."
# mysql -u youpub_user -p youpub_db < database/migrations/006_fix_youtube_account_fields.sql

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PHP-FPM..."
sudo systemctl restart php8.1-fpm

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –°–∞–π—Ç –æ–±–Ω–æ–≤–ª–µ–Ω."
```

–°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x /ssd/www/youpub/update.sh
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```bash
/ssd/www/youpub/update.sh
```
